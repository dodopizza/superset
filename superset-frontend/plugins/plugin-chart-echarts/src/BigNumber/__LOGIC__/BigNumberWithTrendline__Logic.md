# BigNumberWithTrendline - Бизнес логика

## Назначение

Компонент для отображения числового значения с графиком тренда и возможностью сравнения с предыдущими периодами.

## Основные параметры

- **Метрика** - числовое значение для отображения
- **Ось X** - временная ось для графика тренда
- **Сравнение** - период для сравнения (lag) и суффикс
- **Формат числа** - настройка отображения числа (D3 формат)
- **Формат даты** - если значение является датой/временем
- **Цвет графика** - настраиваемый цвет тренда
- **Размер шрифта** - основного числа и подзаголовка
- **Value to show** (DODO) - какое значение показывать (последнее, среднее, первое)

## Логика работы

1. **Отображение тренда**:

   - График строится по временной оси (X) и метрике (Y)
   - Поддерживается плавность линий и настройка области под графиком
   - Можно фиксировать диапазон времени (time_range_fixed)

2. **Сравнение периодов**:

   - Расчет процентного изменения относительно периода compare_lag назад
   - Отображение изменения в подзаголовке
   - Цветовая индикация (положительный/отрицательный тренд)

3. **Продвинутая аналитика**:
   - Скользящие окна (rolling window) с разными функциями
   - Ресемплинг данных с различными методами интерполяции

## Особенности DODO

1. Дополнительные параметры:

   - Выбор отображаемого значения (последнее/среднее/первое)
   - Выравнивание текста (left/center/right)
   - Улучшенное форматирование чисел
   - Условное форматирование:
     - Изменение цвета числа и графика по заданным правилам
     - Настройка сообщений для разных условий
     - Размер шрифта сообщений
   - Export as time - опция для экспорта числовых значений в формате времени:
     - Преобразует числовое значение (в миллисекундах) в формат времени (ЧЧ:ММ:СС)
     - Полезно для метрик, представляющих длительность или временные интервалы
     - При включении этой опции, значение 3,600,000 (миллисекунд) будет экспортировано как "01:00:00" (1 час)
     - Реализовано через функцию `convert_to_time()` на бэкенде, которая делит значение на 1000 и форматирует в ЧЧ:ММ:СС

2. Улучшенная аналитика:
   - Поддержка разных стратегий выбора значения
   - Расширенные настройки условного форматирования
   - Пример конфигурации:
     ```json
     {
       "conditionalFormatting": [
         {
           "operator": ">",
           "threshold": 1000,
           "color": "green",
           "message": "Выше целевого показателя"
         },
         {
           "operator": "<",
           "threshold": 500,
           "color": "red",
           "message": "Ниже минимального уровня"
         }
       ],
       "valueToShow": "average"
     }
     ```

## Примеры использования

1. Мониторинг KPI с визуализацией тренда
2. Отображение изменений метрик за период
3. Интерактивные дашборды с детализацией по времени
