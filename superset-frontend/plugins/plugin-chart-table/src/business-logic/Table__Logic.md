# Документация бизнес-логики для Table в Superset

## Назначение

Компонент Table предназначен для отображения данных в табличном формате с возможностью:

- Сортировки по колонкам
- Постраничной навигации
- Настройки видимости и порядка колонок
- Условного форматирования ячеек

## Основные параметры

- **pageLength** - Количество строк на странице
- **showCellBars** - Отображение прогресс-баров в ячейках
- **columnFormats** - Форматирование значений в колонках
- **conditionalFormatting** - Правила условного форматирования
- **includeSearch** - Включение поиска по таблице // DODO

## Логика работы

1. **Обработка данных**:

   - Преобразование сырых данных в формат таблицы
   - Применение сортировки и фильтрации
   - Подготовка данных для постраничного отображения

2. **Рендеринг таблицы**:
   - Генерация заголовков колонок
   - Отрисовка строк данных с учетом пагинации
   - Применение форматирования к ячейкам // DODO: улучшенный алгоритм форматирования

## Форматирование и отображение

1. **Форматирование значений**:

   - Числовые форматы (проценты, валюта)
   - Форматы дат/времени
   - Кастомные форматы для специфичных типов данных

2. **Визуальные настройки**:
   - Цветовые схемы строк (чередование, выделение)
   - Настройки шрифтов и выравнивания
   - Ширина колонок и перенос текста // DODO: умный перенос длинного текста

## Особенности DODO

1. **Дополнительные параметры**:

   - Условное форматирование ячеек (DODO модификации 45525377)
   - Кастомные итоговые строки (обработка totals)
   - Фиксация колонок (реализовано через getPinnedWidth, DODO 45525377)
   - Описания метрик (datasourceDescriptions, DODO 44728892)
   - Кастомная сортировка (getTableSortOrder, DODO 44136746)

2. **Улучшенная логика**:
   - Оптимизированная работа с большими таблицами
   - Дополнительные варианты сортировки
   - Кастомное условное форматирование (цветовые схемы)
   - Расширенная конфигурация колонок
   - Алгоритм расчета ширины закрепленных колонок (getPinnedWidth):
     ```typescript
     // Функция рассчитывает суммарную ширину всех закрепленных колонок
     // до указанного индекса для корректного позиционирования
     function getPinnedWidth(
       colWidths: number[],
       pinnedColumns: number[],
       currentIndex: number,
     ): number;
     ```
   - Пример конфигурации:
     ```json
     {
       "pageLength": 25,
       "showCellBars": true,
       "dodo_export": "full",
       "conditionalFormatting": {
         "rules": [
           {
             "column": "sales",
             "operator": ">",
             "value": 1000,
             "color": "green"
           }
         ]
       }
     }
     ```

## Примеры использования

1. Базовая таблица с сортировкой и пагинацией
2. Таблица с условным форматированием ячеек
3. Таблица с DODO-экспортом и кастомными итогами

## Референсы

1. **Файлы реализации**:

   - `superset-frontend/plugins/plugin-chart-table/src/TableChart.tsx`
   - `superset-frontend/plugins/plugin-chart-table/src/transformProps.ts`
   - `superset-frontend/plugins/plugin-chart-table/src/controlPanel.ts`

2. **Связанные компоненты**:
   - `TableChart` - Основной компонент таблицы
   - `Pagination` - Компонент пагинации
   - `ColumnSelector` - Выбор колонок // DODO

## Примечания

- Для больших таблиц (>10k строк) рекомендуется использовать виртуализацию
- DODO-модификации требуют дополнительных прав доступа
